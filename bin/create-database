#!/bin/bash
set -e -o pipefail -o nounset

isdb=$(dirname $0)/..
dbname=${PGDATABASE:-isdb}
psql="psql --set ON_ERROR_STOP=1 $dbname"

createdb $dbname -E UTF-8
$psql <<<"REVOKE CREATE ON SCHEMA public FROM PUBLIC;"
$psql < $isdb/schema/tables.sql
$psql < $isdb/schema/views.sql
$psql < $isdb/schema/acl.sql
$isdb/bin/load-genes \
    --gff <(gunzip -qc $isdb/schema/data/ref_GRCh38.p2_top_level.gff3.gz) \
    --chrmap $isdb/schema/data/chr_accessions_GRCh38.p2
